"use strict";(self.webpackChunkmain_app=self.webpackChunkmain_app||[]).push([[626],{9626:(_,m,l)=>{l.r(m),l.d(m,{MonitorComponent:()=>C});var h=l(177),c=l(5596),s=l(2792),g=l(6697),p=l(4572),u=l(6354),f=l(8834),e=l(4438),E=l(2275),v=l(8147);function M(r,b){if(1&r){const t=e.RV6();e.j41(0,"softbar-app-table-paging",6),e.nI1(1,"async"),e.bIt("pageChange",function(n){e.eBV(t);const i=e.XpG();return e.Njj(i.firePage(n))}),e.k0s()}if(2&r){let t;const a=e.XpG();e.Y8G("pageSize",a.pageSize)("pageNum",((null==(t=e.bMT(1,3,a.lazyEvent))?null:t.pageNum)||0)+1)("totalRecords",a.totalRecords)}}let C=(()=>{class r extends s.Px{getLazyEvent(){return this.lazyEvent}ngOnInit(){this.studentLocalStorageService.getCollection("student").pipe((0,g.s)(1)).subscribe(t=>{this.filters.push({label:"ID",key:"id",filterType:"multiSelect",matchMode:s.V8.Contained,options:t?.map(a=>({label:a?.id?.toString(),value:a?.id}))},{label:"Name",key:"name",filterType:"freeText",initialValue(){return this.matchModes[0]},matchModes:[{label:"Contains",matchMode:s.V8.Contains},{label:"Contained",matchMode:s.V8.Contained},{label:"Starts With",matchMode:s.V8.StartsWith},{label:"Ends With",matchMode:s.V8.EndsWith}]})})}getDataProvider(t){return(0,p.z)([this.studentLocalStorageService.getCollectionLazyLoad("student",{pageSize:Number.MAX_SAFE_INTEGER,pageNum:0}),this.examLocalStorageService.getCollectionLazyLoad("exam",{pageSize:Number.MAX_SAFE_INTEGER,pageNum:0})]).pipe((0,g.s)(1),(0,u.T)(([a,n])=>this.tableFiltersServiceService.filter(this.calculateMonitorData(a?.data,n?.data),t)))}calculateMonitorData(t,a){return t.map(n=>{const i=a.filter(d=>d.studentId===n.id),o=i.length,S=o>0?i.reduce((d,y)=>d+y.grade,0)/o:0;return{id:n.id,name:n.name,exams:o,average:parseFloat(S.toFixed(2))}})}constructor(t,a,n){super(),this.examLocalStorageService=t,this.studentLocalStorageService=a,this.tableFiltersServiceService=n,this.class=((i="h-full")=>i)(),this.pageSize=10,this.filters=[],this.trStyleFunc=i=>i?.average?i?.average>65?((o="!bg-green-400")=>o)():((o="!bg-red-600")=>o)():"",this.filterLocalStorageKey="page-monitor-table-filters",this.columns=[{field:"id",type:"Default",label:"ID"},{field:"name",type:"Default",label:"Name"},{field:"average",type:"Default",label:"Average"},{field:"exams",type:"Default",label:"Exams No"},{field:"id",label:"Actions",type:"DynamicLazy",loadCustomCellComponent:({calBack:i})=>Promise.all([l.e(669),l.e(76)]).then(l.bind(l,4828)).then(o=>i({component:o.StudentActionCellComponent}))},{field:"id",label:"Exam Actions",type:"DynamicLazy",loadCustomCellComponent:({calBack:i})=>l.e(991).then(l.bind(l,1991)).then(o=>i({component:o.MonitorExamActionCellComponent}))}],this.lazyEvent.next({pageNum:0,pageSize:this.pageSize})}firePage({pageNum:t}){this.lazyEvent?.next({...this.lazyEvent.value,pageNum:t-1})}fireFilter(t){t?.id?.matchMode||(t.id.matchMode=this.filters?.find(a=>"id"===a?.key).matchMode),t?.id?.value?.length||delete t.id,t?.name?.matchMode||(t.name.matchMode=(this.filters?.find(a=>"name"===a?.key).initialValue()).matchMode),this.lazyEvent?.next({...this.lazyEvent.value,filters:[t],pageNum:0})}static{this.\u0275fac=function(a){return new(a||r)(e.rXU(E.V),e.rXU(v.b),e.rXU(s.MP))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["softbar-monitor"]],hostVars:2,hostBindings:function(a,n){2&a&&e.HbH(n.class)},features:[e.Vt3],decls:9,vars:9,consts:[[1,"table-card","h-full","!m-0","p-7"],[1,"flex","justify-between"],[1,"flex","pb-2","justify-between","items-center"],["showResetFilters","Show All",3,"filterChange","saveStorageId","filters"],[3,"trStyleFunc","columns","items","loading","loadingRowsLength"],[1,"flex","print:hidden",3,"pageSize","pageNum","totalRecords"],[1,"flex","print:hidden",3,"pageChange","pageSize","pageNum","totalRecords"]],template:function(a,n){1&a&&(e.j41(0,"mat-card",0)(1,"div",1)(2,"mat-card-title")(3,"h1"),e.EFF(4,"Monitor"),e.k0s()()(),e.j41(5,"div",2)(6,"softbar-app-table-filters",3),e.bIt("filterChange",function(o){return n.fireFilter(o)}),e.k0s()(),e.nrm(7,"softbar-app-table",4),e.DNE(8,M,2,5,"softbar-app-table-paging",5),e.k0s()),2&a&&(e.R7$(6),e.Y8G("saveStorageId",n.filterLocalStorageKey)("filters",n.filters),e.R7$(),e.Y8G("trStyleFunc",n.trStyleFunc)("columns",n.columns)("items",n.items)("loading",n.loading)("loadingRowsLength",n.pageSize)("columns",n.columns),e.R7$(),e.vxM(null!=n.items&&n.items.length?8:-1))},dependencies:[c.RN,c.dh,s.Or,h.Jj,s.yv,s.hq,f.Hl],encapsulation:2})}}return r})()}}]);